{
  "code" : "org.meveo.script.openstack.OpenstackAPI",
  "description" : "Openstack \"factory\" for API's call",
  "inputs" : [ ],
  "outputs" : [ ],
  "generateOutputs" : false,
  "type" : "JAVA",
  "transactionType" : "SAME",
  "script" : "package org.meveo.script.openstack;\r\n\r\nimport java.util.Map;\r\n\r\nimport org.meveo.service.script.Script;\r\nimport org.meveo.admin.exception.BusinessException;\r\nimport org.slf4j.Logger;\r\nimport org.slf4j.LoggerFactory;\r\nimport javax.ws.rs.client.*;\r\nimport javax.ws.rs.core.*;\r\nimport com.google.gson.*;\r\nimport java.util.List;\r\nimport java.util.ArrayList;\r\n\r\npublic class OpenstackAPI extends Script {\r\n\r\n    private static final Logger log = LoggerFactory.getLogger(ListOVHServersScript.class);\r\n  \r\n  \tprivate String computeBaseAPI = \"https://compute.gra11.cloud.ovh.net/v2.1/\";\r\n  \r\n  \tprivate String networkBaseAPI = \"https://network.compute.gra11.cloud.ovh.net/v2.0/\";\r\n  \r\n  \tprivate String imageBaseAPI = \"https://image.compute.gra11.cloud.ovh.net/v2/\";\r\n  \r\n  \tprivate String identityBaseAPI = \"https://auth.cloud.ovh.net/\";\r\n  \r\n  \tpublic List<JsonObject> computeAPI(String url, String token, String jsonBody, String methodType, String objReturn) throws BusinessException {\r\n      \tList<JsonObject> res = new ArrayList<>();\r\n        Client client = ClientBuilder.newClient();\r\n      \tif (methodType.equalsIgnoreCase(\"get\")) {\r\n            WebTarget target = client.target(this.computeBaseAPI + url);\r\n            Response response = target.request().header(\"X-Auth-Token\", token).get();\r\n            String value = response.readEntity(String.class);\r\n            if (response.getStatus() < 300) {\r\n                JsonArray rootArray = new JsonParser().parse(value).getAsJsonObject().getAsJsonArray(objReturn);\r\n                for (JsonElement element : rootArray) {\r\n                    JsonObject JObject = element.getAsJsonObject();\r\n                    res.add(JObject);\r\n                }\r\n            }\r\n            response.close();\r\n        } else if (methodType.equalsIgnoreCase(\"post\")) {\r\n            WebTarget target = client.target(this.computeBaseAPI + url);\r\n            Response response = target.request().header(\"X-Auth-Token\", token).post(Entity.json(jsonBody));\r\n            String value = response.readEntity(String.class);\r\n            if (response.getStatus() < 300) {\r\n              \tJsonParser jp = new JsonParser();\r\n              \t//if (jp.parse(value).getAsJsonObject().getAsJsonArray(objReturn) instanceof JsonObject) {\r\n                \tJsonArray rootArray = new JsonParser().parse(value).getAsJsonObject().getAsJsonArray(objReturn);\r\n                    for (JsonElement element : rootArray) {\r\n                        JsonObject JObject = element.getAsJsonObject();\r\n                        res.add(JObject);\r\n                    }\r\n                //} else {\r\n                //  \tJsonObject obj = new JsonParser().parse(value).getAsJsonObject();\r\n                //  \tres.add(obj);\r\n                //}\r\n            }\r\n            response.close();\r\n        } else if (methodType.equalsIgnoreCase(\"delete\")) {\r\n            WebTarget target = client.target(this.computeBaseAPI + url);\r\n            Response response = target.request().header(\"X-Auth-Token\", token).delete();\r\n            String value = response.readEntity(String.class);\r\n            response.close();\r\n        } else if (methodType.equalsIgnoreCase(\"put\")) {\r\n        } else {\r\n          \tthrow new BusinessException(\"Cannot found \" + methodType + \" in method type request. Available methods : get, post, delete, put\");\r\n        }\r\n\t\tclient.close();\r\n      \treturn res;\r\n    }\r\n  \r\n  \tpublic List<JsonObject> networkAPI(String url, String token, String jsonBody, String methodType, String objReturn) {\r\n      \tList<JsonObject> res = new ArrayList<>();\r\n\t\tClient client = ClientBuilder.newClient();\r\n      \tWebTarget target = client.target(this.networkBaseAPI + url);\r\n      \tResponse response = target.request().header(\"X-Auth-Token\", token).get();\r\n      \tString value = response.readEntity(String.class);\r\n      \tif (response.getStatus() < 300) {\r\n          \tJsonArray rootArray = new JsonParser().parse(value).getAsJsonObject().getAsJsonArray(objReturn);\r\n            for (JsonElement element : rootArray) {\r\n            \tJsonObject JObject = element.getAsJsonObject();\r\n              \tres.add(JObject);\r\n            }\r\n        }\r\n      \tresponse.close();\r\n      \tclient.close();\r\n      \treturn res;\r\n    }\r\n  \r\n  \tpublic List<JsonObject> imageAPI(String url, String token, String jsonBody, String methodType, String objReturn) {\r\n      \tList<JsonObject> res = new ArrayList<>();\r\n\t\tClient client = ClientBuilder.newClient();\r\n      \tWebTarget target = client.target(this.imageBaseAPI + url);\r\n      \tResponse response = target.request().header(\"X-Auth-Token\", token).get();\r\n      \tString value = response.readEntity(String.class);\r\n      \tif (response.getStatus() < 300) {\r\n          \tJsonArray rootArray = new JsonParser().parse(value).getAsJsonObject().getAsJsonArray(objReturn);\r\n            for (JsonElement element : rootArray) {\r\n            \tJsonObject JObject = element.getAsJsonObject();\r\n              \tres.add(JObject);\r\n            }\r\n        }\r\n      \tresponse.close();\r\n      \tclient.close();\r\n      \treturn res;\r\n    }\r\n  \r\n  \tpublic List<JsonObject> IdentityAPI(String url, String token, String jsonBody, String methodType, String objReturn) {\r\n      \tList<JsonObject> res = new ArrayList<>();\r\n\t\tClient client = ClientBuilder.newClient();\r\n      \tWebTarget target = client.target(this.identityBaseAPI + url);\r\n      \tResponse response = target.request().header(\"X-Auth-Token\", token).get();\r\n      \tString value = response.readEntity(String.class);\r\n      \tif (response.getStatus() < 300) {\r\n          \tJsonArray rootArray = new JsonParser().parse(value).getAsJsonObject().getAsJsonArray(objReturn);\r\n            for (JsonElement element : rootArray) {\r\n            \tJsonObject JObject = element.getAsJsonObject();\r\n              \tres.add(JObject);\r\n            }\r\n        }\r\n      \tresponse.close();\r\n      \tclient.close();\r\n      \treturn res;\r\n    }\r\n\t\r\n\t@Override\r\n\tpublic void execute(Map<String, Object> parameters) throws BusinessException {\r\n\t\tsuper.execute(parameters);\r\n\t}\r\n  \r\n\t\r\n}",
  "executionRoles" : [ ],
  "sourcingRoles" : [ ],
  "mavenDependencies" : [ ],
  "importScriptInstances" : [ ]
}