[ {
  "active" : true,
  "code" : "credentials",
  "description" : "credentials",
  "license" : "GPL",
  "currentVersion" : "1.2.4",
  "meveoVersionBase" : "6.11.0",
  "transient" : true,
  "inDraft" : true,
  "codeOnly" : false,
  "moduleItems" : [ {
    "dtoClassName" : "org.meveo.api.dto.ScriptInstanceDto",
    "dtoData" : {
      "active" : true,
      "code" : "org.meveo.credentials.CredentialHelperService",
      "description" : "Helper function to build request with credentials",
      "inputs" : [ ],
      "outputs" : [ ],
      "generateOutputs" : false,
      "type" : "JAVA",
      "transactionType" : "SAME",
      "script" : "package org.meveo.credentials;\r\n\r\nimport java.util.Map;\r\n\r\nimport org.meveo.service.script.Script;\r\nimport org.meveo.admin.exception.BusinessException;\r\nimport javax.ws.rs.client.*;\r\n\r\nimport java.io.IOException;\r\nimport java.util.List;\r\nimport org.meveo.model.customEntities.Credential;\r\nimport org.meveo.model.storage.Repository;\r\nimport org.meveo.api.persistence.CrossStorageApi;\r\nimport org.meveo.elresolver.ValueExpressionWrapper;\r\nimport org.slf4j.Logger;\r\nimport org.slf4j.LoggerFactory;\r\n\r\npublic class CredentialHelperService extends Script {\r\n  \r\n  private static final Logger log = LoggerFactory.getLogger(CredentialHelperService.class);\r\n\r\n    public static class LoggingFilter implements ClientRequestFilter {\r\n        @Override\r\n        public void filter(ClientRequestContext requestContext) throws IOException {\r\n            if(requestContext!=null){\r\n              if(requestContext.getEntity()!=null){\r\n                log.info(requestContext.getEntity().toString());\r\n              } else {\r\n                log.info(\"uri:{}\",requestContext.getUri());\r\n              }\r\n            }\r\n        }\r\n    }\r\n\r\n    public static Credential getCredential(String domain,CrossStorageApi crossStorageApiInstance,Repository repo){\r\n      List<Credential> matchigCredentials = crossStorageApiInstance.find(repo, Credential.class)\r\n                .by(\"domainName\", domain)\r\n\t\t\t\t.getResults();\r\n      if(matchigCredentials.size()>0){\r\n        return matchigCredentials.get(0);\r\n      } else {\r\n        return null;\r\n      }\r\n    }\r\n  \r\n    public static Invocation.Builder setCredential(Invocation.Builder invocBuilder,Credential credential) throws BusinessException {\r\n      String headerKey = credential.getHeaderKey();\r\n      String headerValue = credential.getHeaderValue();\r\n      try{\r\n        if(headerKey.contains(\"#{\")){\r\n          headerKey=ValueExpressionWrapper.evaluateToStringMultiVariable(headerKey,\"entity\",credential);\r\n        }\r\n        if(headerValue.contains(\"#{\")){\r\n          headerValue=ValueExpressionWrapper.evaluateToStringMultiVariable(headerValue,\"entity\",credential);\r\n        }\r\n      } catch(Exception e) {\r\n        throw new BusinessException(e);\r\n      }\r\n      return invocBuilder.header(headerKey, headerValue);\r\n    }\r\n  \r\n\t@Override\r\n\tpublic void execute(Map<String, Object> parameters) throws BusinessException {\r\n    }\r\n\t\r\n}",
      "executionRoles" : [ ],
      "sourcingRoles" : [ ],
      "mavenDependencies" : [ ],
      "importScriptInstances" : [ ]
    }
  }, {
    "dtoClassName" : "org.meveo.api.dto.CustomEntityTemplateDto",
    "dtoData" : {
      "code" : "Credential",
      "name" : "Credential",
      "description" : "Credentials used to acces remote server or services",
      "customEntityCategoryCode" : "INFRA",
      "availableStorages" : [ "SQL" ],
      "sqlStorageConfiguration" : {
        "storeAsTable" : true
      },
      "samples" : [ ],
      "audited" : false,
      "fields" : [ {
        "code" : "apiKey",
        "description" : "Api key",
        "fieldType" : "STRING",
        "accountLevel" : "CE_Credential",
        "appliesTo" : "CE_Credential",
        "useInheritedAsDefaultValue" : false,
        "storageType" : "SINGLE",
        "valueRequired" : false,
        "versionable" : false,
        "triggerEndPeriodEvent" : false,
        "listValues" : { },
        "allowEdit" : true,
        "hideOnNew" : false,
        "maxValue" : 255,
        "contentTypes" : [ ],
        "fileExtensions" : [ ],
        "saveOnExplorer" : false,
        "guiPosition" : "tab:Credential:0;field:14",
        "identifier" : false,
        "storages" : [ "SQL" ],
        "samples" : [ ],
        "summary" : false,
        "audited" : false,
        "persisted" : true,
        "filter" : false,
        "unique" : false,
        "matrixColumns" : [ ]
      }, {
        "code" : "authenticationType",
        "description" : "Authentication type",
        "fieldType" : "LIST",
        "accountLevel" : "CE_Credential",
        "appliesTo" : "CE_Credential",
        "defaultValue" : "HTTP_BASIC",
        "useInheritedAsDefaultValue" : false,
        "storageType" : "SINGLE",
        "valueRequired" : false,
        "versionable" : false,
        "triggerEndPeriodEvent" : false,
        "listValues" : {
          "BASIC_HTTP" : "Basic HTTP",
          "HEADER" : "Header Token",
          "OAUTH2" : "Oauth 2",
          "SSH" : "SSH"
        },
        "allowEdit" : true,
        "hideOnNew" : false,
        "contentTypes" : [ ],
        "fileExtensions" : [ ],
        "saveOnExplorer" : false,
        "guiPosition" : "tab:Credential:0;field:6",
        "identifier" : false,
        "storages" : [ "SQL" ],
        "samples" : [ ],
        "summary" : false,
        "audited" : false,
        "persisted" : true,
        "filter" : false,
        "unique" : false,
        "matrixColumns" : [ ]
      }, {
        "code" : "credit",
        "description" : "Credit",
        "fieldType" : "LONG",
        "accountLevel" : "CE_Credential",
        "appliesTo" : "CE_Credential",
        "useInheritedAsDefaultValue" : false,
        "storageType" : "SINGLE",
        "valueRequired" : false,
        "versionable" : false,
        "triggerEndPeriodEvent" : false,
        "listValues" : { },
        "allowEdit" : true,
        "hideOnNew" : false,
        "minValue" : 0,
        "contentTypes" : [ ],
        "fileExtensions" : [ ],
        "saveOnExplorer" : false,
        "guiPosition" : "tab:Credential:0;field:13",
        "identifier" : false,
        "storages" : [ "SQL" ],
        "samples" : [ ],
        "summary" : false,
        "audited" : false,
        "persisted" : true,
        "filter" : false,
        "unique" : false,
        "matrixColumns" : [ ]
      }, {
        "code" : "domainName",
        "description" : "Domain or IP",
        "fieldType" : "STRING",
        "accountLevel" : "CE_Credential",
        "appliesTo" : "CE_Credential",
        "useInheritedAsDefaultValue" : false,
        "storageType" : "SINGLE",
        "valueRequired" : false,
        "versionable" : false,
        "triggerEndPeriodEvent" : false,
        "listValues" : { },
        "allowEdit" : true,
        "hideOnNew" : false,
        "maxValue" : 1000,
        "contentTypes" : [ ],
        "fileExtensions" : [ ],
        "saveOnExplorer" : false,
        "guiPosition" : "tab:Credential:0;field:0",
        "identifier" : false,
        "storages" : [ "SQL" ],
        "samples" : [ ],
        "summary" : true,
        "audited" : false,
        "persisted" : true,
        "filter" : false,
        "unique" : false,
        "matrixColumns" : [ ]
      }, {
        "code" : "headerKey",
        "description" : "Header key EL",
        "fieldType" : "STRING",
        "accountLevel" : "CE_Credential",
        "appliesTo" : "CE_Credential",
        "defaultValue" : "X-API-KEY",
        "useInheritedAsDefaultValue" : false,
        "storageType" : "SINGLE",
        "valueRequired" : false,
        "versionable" : false,
        "triggerEndPeriodEvent" : false,
        "listValues" : { },
        "allowEdit" : true,
        "hideOnNew" : false,
        "maxValue" : 50,
        "contentTypes" : [ ],
        "fileExtensions" : [ ],
        "saveOnExplorer" : false,
        "guiPosition" : "tab:Credential:0;field:7",
        "identifier" : false,
        "storages" : [ "SQL" ],
        "samples" : [ ],
        "summary" : true,
        "audited" : false,
        "persisted" : true,
        "filter" : false,
        "unique" : false,
        "matrixColumns" : [ ]
      }, {
        "code" : "headerValue",
        "description" : "Header value EL",
        "fieldType" : "STRING",
        "accountLevel" : "CE_Credential",
        "appliesTo" : "CE_Credential",
        "useInheritedAsDefaultValue" : false,
        "storageType" : "SINGLE",
        "valueRequired" : false,
        "versionable" : false,
        "triggerEndPeriodEvent" : false,
        "listValues" : { },
        "allowEdit" : true,
        "hideOnNew" : false,
        "maxValue" : 1000,
        "contentTypes" : [ ],
        "fileExtensions" : [ ],
        "saveOnExplorer" : false,
        "guiPosition" : "tab:Credential:0;field:8",
        "identifier" : false,
        "storages" : [ "SQL" ],
        "samples" : [ ],
        "summary" : false,
        "audited" : false,
        "persisted" : true,
        "filter" : false,
        "unique" : false,
        "matrixColumns" : [ ]
      }, {
        "code" : "lastConnection",
        "description" : "Last connection",
        "fieldType" : "DATE",
        "accountLevel" : "CE_Credential",
        "appliesTo" : "CE_Credential",
        "useInheritedAsDefaultValue" : false,
        "storageType" : "SINGLE",
        "valueRequired" : false,
        "versionable" : false,
        "triggerEndPeriodEvent" : false,
        "listValues" : { },
        "allowEdit" : true,
        "hideOnNew" : false,
        "contentTypes" : [ ],
        "fileExtensions" : [ ],
        "saveOnExplorer" : false,
        "guiPosition" : "tab:Credential:0;field:9",
        "identifier" : false,
        "storages" : [ "SQL" ],
        "samples" : [ ],
        "summary" : true,
        "audited" : false,
        "persisted" : true,
        "filter" : false,
        "unique" : false,
        "matrixColumns" : [ ]
      }, {
        "code" : "password",
        "description" : "Password",
        "fieldType" : "STRING",
        "accountLevel" : "CE_Credential",
        "appliesTo" : "CE_Credential",
        "useInheritedAsDefaultValue" : false,
        "storageType" : "SINGLE",
        "valueRequired" : false,
        "versionable" : false,
        "triggerEndPeriodEvent" : false,
        "listValues" : { },
        "allowEdit" : true,
        "hideOnNew" : false,
        "maxValue" : 50,
        "contentTypes" : [ ],
        "fileExtensions" : [ ],
        "saveOnExplorer" : false,
        "guiPosition" : "tab:Credential:0;field:2",
        "identifier" : false,
        "storages" : [ "SQL" ],
        "samples" : [ ],
        "summary" : false,
        "audited" : false,
        "persisted" : true,
        "filter" : false,
        "unique" : false,
        "matrixColumns" : [ ]
      }, {
        "code" : "privateKey",
        "description" : "ssh private key",
        "fieldType" : "BINARY",
        "accountLevel" : "CE_Credential",
        "appliesTo" : "CE_Credential",
        "useInheritedAsDefaultValue" : false,
        "storageType" : "SINGLE",
        "valueRequired" : false,
        "versionable" : false,
        "triggerEndPeriodEvent" : false,
        "listValues" : { },
        "allowEdit" : true,
        "hideOnNew" : false,
        "contentTypes" : [ "application/octet-stream" ],
        "fileExtensions" : [ ],
        "maxFileSizeAllowedInKb" : 4,
        "saveOnExplorer" : false,
        "guiPosition" : "tab:Credential:0;field:11",
        "identifier" : false,
        "storages" : [ "SQL" ],
        "samples" : [ ],
        "summary" : false,
        "audited" : false,
        "persisted" : true,
        "filter" : false,
        "unique" : false,
        "matrixColumns" : [ ]
      }, {
        "code" : "publicKey",
        "description" : "ssh public key",
        "fieldType" : "BINARY",
        "accountLevel" : "CE_Credential",
        "appliesTo" : "CE_Credential",
        "useInheritedAsDefaultValue" : false,
        "storageType" : "SINGLE",
        "valueRequired" : false,
        "versionable" : false,
        "triggerEndPeriodEvent" : false,
        "listValues" : { },
        "allowEdit" : true,
        "hideOnNew" : false,
        "contentTypes" : [ "application/octet-stream" ],
        "fileExtensions" : [ ],
        "maxFileSizeAllowedInKb" : 3,
        "saveOnExplorer" : false,
        "guiPosition" : "tab:Credential:0;field:12",
        "identifier" : false,
        "storages" : [ "SQL" ],
        "samples" : [ ],
        "summary" : false,
        "audited" : false,
        "persisted" : true,
        "filter" : false,
        "unique" : false,
        "matrixColumns" : [ ]
      }, {
        "code" : "refreshToken",
        "description" : "Refresh Token",
        "fieldType" : "STRING",
        "accountLevel" : "CE_Credential",
        "appliesTo" : "CE_Credential",
        "useInheritedAsDefaultValue" : false,
        "storageType" : "SINGLE",
        "valueRequired" : false,
        "versionable" : false,
        "triggerEndPeriodEvent" : false,
        "listValues" : { },
        "allowEdit" : true,
        "hideOnNew" : false,
        "maxValue" : 255,
        "contentTypes" : [ ],
        "fileExtensions" : [ ],
        "saveOnExplorer" : false,
        "guiPosition" : "tab:Credential:0;field:4",
        "identifier" : false,
        "storages" : [ "SQL" ],
        "samples" : [ ],
        "summary" : false,
        "audited" : false,
        "persisted" : true,
        "filter" : false,
        "unique" : false,
        "matrixColumns" : [ ]
      }, {
        "code" : "status",
        "description" : "Status",
        "fieldType" : "LIST",
        "accountLevel" : "CE_Credential",
        "appliesTo" : "CE_Credential",
        "defaultValue" : "ACTIVE",
        "useInheritedAsDefaultValue" : false,
        "storageType" : "SINGLE",
        "valueRequired" : false,
        "versionable" : false,
        "triggerEndPeriodEvent" : false,
        "listValues" : {
          "ACTIVE" : "Active",
          "INACTIVE" : "Inactive"
        },
        "allowEdit" : true,
        "hideOnNew" : false,
        "contentTypes" : [ ],
        "fileExtensions" : [ ],
        "saveOnExplorer" : false,
        "guiPosition" : "tab:Credential:0;field:10",
        "identifier" : false,
        "storages" : [ "SQL" ],
        "samples" : [ ],
        "summary" : false,
        "audited" : false,
        "persisted" : true,
        "filter" : false,
        "unique" : false,
        "matrixColumns" : [ ]
      }, {
        "code" : "token",
        "description" : "Token",
        "fieldType" : "STRING",
        "accountLevel" : "CE_Credential",
        "appliesTo" : "CE_Credential",
        "useInheritedAsDefaultValue" : false,
        "storageType" : "SINGLE",
        "valueRequired" : false,
        "versionable" : false,
        "triggerEndPeriodEvent" : false,
        "listValues" : { },
        "allowEdit" : true,
        "hideOnNew" : false,
        "maxValue" : 255,
        "contentTypes" : [ ],
        "fileExtensions" : [ ],
        "saveOnExplorer" : false,
        "guiPosition" : "tab:Credential:0;field:3",
        "identifier" : false,
        "storages" : [ "SQL" ],
        "samples" : [ ],
        "summary" : false,
        "audited" : false,
        "persisted" : true,
        "filter" : false,
        "unique" : false,
        "matrixColumns" : [ ]
      }, {
        "code" : "tokenExpiry",
        "description" : "Token Expiry",
        "fieldType" : "DATE",
        "accountLevel" : "CE_Credential",
        "appliesTo" : "CE_Credential",
        "useInheritedAsDefaultValue" : false,
        "storageType" : "SINGLE",
        "valueRequired" : false,
        "versionable" : false,
        "triggerEndPeriodEvent" : false,
        "listValues" : { },
        "allowEdit" : true,
        "hideOnNew" : false,
        "contentTypes" : [ ],
        "fileExtensions" : [ ],
        "saveOnExplorer" : false,
        "guiPosition" : "tab:Credential:0;field:5",
        "identifier" : false,
        "storages" : [ "SQL" ],
        "samples" : [ ],
        "summary" : false,
        "audited" : false,
        "persisted" : true,
        "filter" : false,
        "unique" : false,
        "matrixColumns" : [ ]
      }, {
        "code" : "username",
        "description" : "Username",
        "fieldType" : "STRING",
        "accountLevel" : "CE_Credential",
        "appliesTo" : "CE_Credential",
        "useInheritedAsDefaultValue" : false,
        "storageType" : "SINGLE",
        "valueRequired" : true,
        "versionable" : false,
        "triggerEndPeriodEvent" : false,
        "listValues" : { },
        "allowEdit" : true,
        "hideOnNew" : false,
        "maxValue" : 255,
        "contentTypes" : [ ],
        "fileExtensions" : [ ],
        "saveOnExplorer" : false,
        "guiPosition" : "tab:Credential:0;field:1",
        "identifier" : false,
        "storages" : [ "SQL" ],
        "samples" : [ ],
        "summary" : true,
        "audited" : false,
        "persisted" : true,
        "filter" : false,
        "unique" : false,
        "matrixColumns" : [ ]
      } ],
      "actions" : [ ]
    }
  }, {
    "dtoClassName" : "org.meveo.api.dto.CustomEntityInstanceDto",
    "dtoData" : {
      "code" : "ac969358-1ef2-45ae-83d8-fec1d456fedf",
      "cetCode" : "Credential",
      "disabled" : false,
      "customFields" : {
        "customField" : [ {
          "code" : "apiKey",
          "empty" : true
        }, {
          "code" : "headerValue",
          "stringValue" : "Apikey #{entity.getToken()}",
          "empty" : false
        }, {
          "code" : "tokenExpiry",
          "empty" : true
        }, {
          "code" : "publicKey",
          "empty" : true
        }, {
          "code" : "lastConnection",
          "empty" : true
        }, {
          "code" : "token",
          "stringValue" : "VJzTrh7leRW6V1nrYnmW5OB6",
          "empty" : false
        }, {
          "code" : "privateKey",
          "empty" : true
        }, {
          "code" : "password",
          "empty" : true
        }, {
          "code" : "domainName",
          "stringValue" : "api.gandi.net/v5/",
          "empty" : false
        }, {
          "code" : "authenticationType",
          "stringValue" : "HEADER",
          "empty" : false
        }, {
          "code" : "headerKey",
          "stringValue" : "Authorization",
          "empty" : false
        }, {
          "code" : "credit",
          "empty" : true
        }, {
          "code" : "refreshToken",
          "empty" : true
        }, {
          "code" : "status",
          "stringValue" : "ACTIVE",
          "empty" : false
        }, {
          "code" : "username",
          "stringValue" : "smichea",
          "empty" : false
        } ],
        "inheritedCustomField" : [ ],
        "empty" : false
      }
    }
  }, {
    "dtoClassName" : "org.meveo.api.dto.CustomEntityInstanceDto",
    "dtoData" : {
      "code" : "f259a9e3-6144-44e2-8dd9-603f4dda50d5",
      "cetCode" : "Credential",
      "disabled" : false,
      "customFields" : {
        "customField" : [ {
          "code" : "apiKey",
          "empty" : true
        }, {
          "code" : "headerValue",
          "stringValue" : "token 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",
          "empty" : false
        }, {
          "code" : "tokenExpiry",
          "empty" : true
        }, {
          "code" : "publicKey",
          "empty" : true
        }, {
          "code" : "lastConnection",
          "empty" : true
        }, {
          "code" : "token",
          "stringValue" : " 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",
          "empty" : false
        }, {
          "code" : "privateKey",
          "empty" : true
        }, {
          "code" : "password",
          "empty" : true
        }, {
          "code" : "domainName",
          "stringValue" : "api.github.com",
          "empty" : false
        }, {
          "code" : "authenticationType",
          "stringValue" : "HEADER",
          "empty" : false
        }, {
          "code" : "headerKey",
          "stringValue" : "Authorization",
          "empty" : false
        }, {
          "code" : "credit",
          "empty" : true
        }, {
          "code" : "refreshToken",
          "empty" : true
        }, {
          "code" : "status",
          "stringValue" : "ACTIVE",
          "empty" : false
        }, {
          "code" : "username",
          "stringValue" : "smichea",
          "empty" : false
        } ],
        "inheritedCustomField" : [ ],
        "empty" : false
      }
    }
  }, {
    "dtoClassName" : "org.meveo.api.dto.CustomEntityInstanceDto",
    "dtoData" : {
      "code" : "ac2f3246-7e80-4a58-b10b-ca943f237be4",
      "cetCode" : "Credential",
      "disabled" : false,
      "customFields" : {
        "customField" : [ {
          "code" : "apiKey",
          "stringValue" : "SCW72N5BY7QPPHF172Y6",
          "empty" : false
        }, {
          "code" : "headerValue",
          "stringValue" : "#{entity.getToken()}",
          "empty" : false
        }, {
          "code" : "tokenExpiry",
          "empty" : true
        }, {
          "code" : "publicKey",
          "empty" : true
        }, {
          "code" : "lastConnection",
          "empty" : true
        }, {
          "code" : "token",
          "stringValue" : "a1e17226-e5b4-4208-a627-85eda44a87f9",
          "empty" : false
        }, {
          "code" : "privateKey",
          "empty" : true
        }, {
          "code" : "password",
          "empty" : true
        }, {
          "code" : "domainName",
          "stringValue" : "api.scaleway.com",
          "empty" : false
        }, {
          "code" : "authenticationType",
          "stringValue" : "HEADER",
          "empty" : false
        }, {
          "code" : "headerKey",
          "stringValue" : "X-Auth-Token",
          "empty" : false
        }, {
          "code" : "credit",
          "empty" : true
        }, {
          "code" : "refreshToken",
          "empty" : true
        }, {
          "code" : "status",
          "stringValue" : "ACTIVE",
          "empty" : false
        }, {
          "code" : "username",
          "stringValue" : "smichea",
          "empty" : false
        } ],
        "inheritedCustomField" : [ ],
        "empty" : false
      }
    }
  } ],
  "moduleDependencies" : [ ],
  "moduleFiles" : [ ]
} ]